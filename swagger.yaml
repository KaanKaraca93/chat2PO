openapi: 3.0.3
info:
  title: ChatdenPO API
  description: |
    ðŸ¤– **AI-Powered PLM Order Management System**
    
    ChatGPT ile PLM SipariÅŸ DaÄŸÄ±lÄ±m API - DoÄŸal dil komutlarÄ±yla otomatik sipariÅŸ oluÅŸturma.
    
    ## ðŸŽ¯ Ã–zellikler
    
    - âœ… **OpenAI GPT-4o-mini** ile doÄŸal dil parsing
    - âœ… **Ã‡oklu renk desteÄŸi** - tek Request'te birleÅŸtirilmiÅŸ
    - âœ… **Infor FashionPLM** entegrasyonu
    - âœ… **Asortisman bazlÄ±** beden daÄŸÄ±lÄ±mÄ±
    - âœ… **Kanal daÄŸÄ±lÄ±mÄ±** (MaÄŸaza/Ä°nternet)
    
    ## ðŸ“– KullanÄ±m
    
    API doÄŸal dilde verilen sipariÅŸ komutlarÄ±nÄ± otomatik olarak parse edip, 
    asortisman bazlÄ± hesaplamalarla PLM'de sipariÅŸ oluÅŸturur.
    
    ## ðŸ”— Links
    
    - **GitHub**: [KaanKaraca93/chat2PO](https://github.com/KaanKaraca93/chat2PO)
    - **Heroku**: [peaceful-spire-06845](https://peaceful-spire-06845-5624ee00a891.herokuapp.com/)
    
  version: 1.0.0
  contact:
    name: Kaan Karaca
    email: kaan.karaca93@gmail.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://peaceful-spire-06845-5624ee00a891.herokuapp.com
    description: Production (Heroku)
  - url: http://localhost:5000
    description: Local Development

tags:
  - name: Order Management
    description: SipariÅŸ oluÅŸturma ve hesaplama iÅŸlemleri
  - name: Testing
    description: Test ve debug endpoint'leri
  - name: System
    description: Sistem bilgileri

paths:
  /:
    get:
      tags:
        - System
      summary: API Bilgileri
      description: API hakkÄ±nda genel bilgi ve Ã¶rnek kullanÄ±mlar
      responses:
        '200':
          description: API bilgileri baÅŸarÄ±yla dÃ¶ndÃ¼rÃ¼ldÃ¼
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiInfo'

  /health:
    get:
      tags:
        - System
      summary: Health Check
      description: API durumunu kontrol eder
      responses:
        '200':
          description: API Ã§alÄ±ÅŸÄ±yor
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'

  /create-order:
    post:
      tags:
        - Order Management
      summary: SipariÅŸ OluÅŸtur (Ã–nerilen)
      description: |
        DoÄŸal dil komutuyla PLM'de otomatik sipariÅŸ oluÅŸturur.
        
        **AkÄ±ÅŸ:**
        1. OpenAI ile komut parse edilir
        2. PLM'den style detaylarÄ± Ã§ekilir
        3. Asortisman bazlÄ± daÄŸÄ±lÄ±m hesaplanÄ±r
        4. PLM'de Request oluÅŸturulur
        
        **Ã‡oklu Renk DesteÄŸi:**
        VirgÃ¼lle ayrÄ±lmÄ±ÅŸ birden fazla renk tek Request'te birleÅŸtirilir.
        
        **Ã–rnek Komutlar:**
        - `"bej 5000 sadece maÄŸaza"`
        - `"siyah 10000 %20 internet"`
        - `"bej 10000 maÄŸaza, gri 5000 %50 internet"`
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateOrderRequest'
            examples:
              single_color:
                summary: Tek Renk
                value:
                  styleId: 325
                  command: "bej 5000 sadece maÄŸaza"
                  supplierId: 38
                  dueDate: "2024-12-31"
                  udf2: "COLLECTION2024"
              multi_color:
                summary: Ã‡oklu Renk
                value:
                  styleId: 325
                  command: "bej 10000 maÄŸaza, gri 5000 %50 internet"
                  supplierId: 38
                  dueDate: "2024-12-31"
                  udf2: "COLLECTION2024"
              with_internet:
                summary: Ä°nternet DaÄŸÄ±lÄ±mlÄ±
                value:
                  styleId: 325
                  command: "siyah rengi 20000 adet %30 internet"
                  supplierId: 38
                  dueDate: "2025-01-15"
                  udf2: "WINTER2024"
      responses:
        '200':
          description: SipariÅŸ baÅŸarÄ±yla oluÅŸturuldu
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CreateOrderResponse'
        '400':
          description: GeÃ§ersiz istek
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Sunucu hatasÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /calculate-order:
    post:
      tags:
        - Order Management
      summary: SipariÅŸ Hesapla (Test)
      description: |
        Sadece hesaplama yapar, PLM'e kaydetmez.
        
        Test ve doÄŸrulama iÃ§in kullanÄ±lÄ±r. AynÄ± parse ve hesaplama 
        mantÄ±ÄŸÄ± kullanÄ±lÄ±r ama PLM'e yazma adÄ±mÄ± atlanÄ±r.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CalculateOrderRequest'
            example:
              styleId: 325
              command: "bej 10000 %20 internet"
      responses:
        '200':
          description: Hesaplama baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalculateOrderResponse'
        '400':
          description: GeÃ§ersiz istek
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /parse-command:
    post:
      tags:
        - Testing
      summary: Komut Parse Et (Test)
      description: |
        Sadece OpenAI parsing testi yapar.
        
        PLM'e eriÅŸmeden, sadece doÄŸal dil komutunun nasÄ±l 
        parse edildiÄŸini gÃ¶sterir.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ParseCommandRequest'
            examples:
              simple:
                summary: Basit Format
                value:
                  styleId: 325
                  command: "bej 5000 maÄŸaza"
              detailed:
                summary: DetaylÄ± Format
                value:
                  styleId: 325
                  command: "BYZ renge 20000 adet sipariÅŸ geÃ§ %10'u internet kanalÄ±na ayrÄ±lsÄ±n"
              multi_color:
                summary: Ã‡oklu Renk
                value:
                  styleId: 325
                  command: "bej 10000 maÄŸaza, gri 5000 %50 internet, siyah 3000 %20 internet"
      responses:
        '200':
          description: Parse baÅŸarÄ±lÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ParseCommandResponse'
        '400':
          description: Parse hatasÄ±
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

components:
  schemas:
    ApiInfo:
      type: object
      properties:
        service:
          type: string
          example: "ChatdenPO API"
        version:
          type: string
          example: "1.0.0"
        description:
          type: string
        endpoints:
          type: object
        mainExample:
          type: object
        calculateExample:
          type: object
        testExample:
          type: object

    HealthResponse:
      type: object
      properties:
        status:
          type: string
          example: "OK"
        timestamp:
          type: string
          format: date-time
        service:
          type: string
          example: "ChatdenPO API"
        version:
          type: string
          example: "1.0.0"
        openai_configured:
          type: boolean

    CreateOrderRequest:
      type: object
      required:
        - styleId
        - command
      properties:
        styleId:
          type: integer
          description: PLM'deki Style ID
          example: 325
        command:
          type: string
          description: |
            DoÄŸal dilde sipariÅŸ komutu.
            
            **Formatlar:**
            - `"renk miktar kanal"`
            - `"renk miktar %X internet"`
            - `"renk1 miktar1 kanal1, renk2 miktar2 kanal2"`
          example: "bej 10000 maÄŸaza, gri 5000 %50 internet"
        supplierId:
          type: integer
          description: TedarikÃ§i ID (opsiyonel, default 38)
          default: 38
          example: 38
        dueDate:
          type: string
          format: date
          description: Teslim tarihi (YYYY-MM-DD)
          example: "2024-12-31"
        udf2:
          type: string
          description: User Defined Field 2 (opsiyonel)
          example: "COLLECTION2024"

    CalculateOrderRequest:
      type: object
      required:
        - styleId
        - command
      properties:
        styleId:
          type: integer
          example: 325
        command:
          type: string
          example: "bej 10000 %20 internet"

    ParseCommandRequest:
      type: object
      required:
        - styleId
        - command
      properties:
        styleId:
          type: integer
          example: 325
        command:
          type: string
          example: "bej 10000 maÄŸaza, gri 5000 %50 internet"

    CreateOrderResponse:
      type: object
      properties:
        status:
          type: string
          enum: [success, error]
        message:
          type: string
        isMultiColor:
          type: boolean
        data:
          type: object
          properties:
            totalColors:
              type: integer
            successfulColors:
              type: integer
            failedColors:
              type: integer
            results:
              type: array
              items:
                $ref: '#/components/schemas/OrderResult'
            errors:
              type: array
              items:
                $ref: '#/components/schemas/OrderError'

    CalculateOrderResponse:
      type: object
      properties:
        status:
          type: string
        message:
          type: string
        isMultiColor:
          type: boolean
        data:
          type: object
          properties:
            totalColors:
              type: integer
            successfulColors:
              type: integer
            failedColors:
              type: integer
            results:
              type: array
              items:
                $ref: '#/components/schemas/CalculationResult'

    ParseCommandResponse:
      type: object
      properties:
        status:
          type: string
        message:
          type: string
        isMultiColor:
          type: boolean
        data:
          type: array
          items:
            $ref: '#/components/schemas/ParsedOrder'

    OrderResult:
      type: object
      properties:
        colorCode:
          type: string
          example: "BEJ"
        quantity:
          type: integer
          example: 10000
        internetPercent:
          type: integer
          example: 0
        plmResponse:
          type: object
          description: PLM'den dÃ¶nen response

    CalculationResult:
      type: object
      properties:
        colorCode:
          type: string
        quantity:
          type: integer
        internetPercent:
          type: integer
        distribution:
          type: object
          properties:
            styleId:
              type: integer
            styleColorwayId:
              type: integer
            sizeRangeId:
              type: integer
            input:
              type: object
            channels:
              type: object
            distribution:
              type: array
              items:
                type: object

    ParsedOrder:
      type: object
      properties:
        styleId:
          type: integer
        colorCode:
          type: string
        quantity:
          type: integer
        internetPercent:
          type: integer

    OrderError:
      type: object
      properties:
        colorCode:
          type: string
        error:
          type: string

    ErrorResponse:
      type: object
      properties:
        status:
          type: string
          example: "error"
        message:
          type: string
        error:
          type: string

